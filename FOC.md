# foc   #
为什么要用foc?  
foc的全名叫**磁场定向控制**。意思就是它能产生任意方向的磁场，无论是30°，还是59.9999°（当然这只是理想情况下的，实际上受限于数字系统的分辨率），而六步换相法，充其量也只能产生6个方向的磁场。理想情况下的foc产生的磁场力的方向始终相差90°（不包括弱磁），因此它每时每刻的效率都是最高的，**也不会产生力的方向上的突变**。也可以说每当转子转过Δθ，便换一次相
![图1](https://img-blog.csdnimg.cn/d2a99ff399304c0895829bdb0ee3110a.PNG?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAamRoZnVzaw==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center)  
> Clarke变换：通过三轴变两轴的坐标变换将采集到的三相电流变化为两相电流Iα和Iβ

> Park变换：通过两轴静止变两轴旋转的坐标变换将转子电角度θ、交流的Iα和Iβ变换为直流的Id和Iq

> 电流环：将Id和Iq经过PID运算，输出Ud和Uq

> 反Park变换：通过两轴旋转变两轴静止的坐标变换将当前转子电角度θ、直流的Ud和Uq变为交流的Uα和Uβ

> 反Clarke变换：通过两轴变三轴的坐标变换将两相的Uα和Uβ变为三相的UA、UB、UC

> SVPWM：将三相电压计算成三个PWM通道的占空比值

> 三相逆变电路：输出三相等效马鞍波

> 电机  

(1）svpwm
​ 原名叫**空间矢量脉宽调制**。它是foc软件中的最后一环，也是最麻烦的一环。通过单片机定时器的中心对齐模式输出三通道的pwm波，驱动三相逆变电路输出等效为马鞍波的方波，而这三相方波（等效马鞍波）最终则施加在电机的UVW三相上（ABC三相）。为什么能等效这里就不解释了，如果对spwm有了解的肯定能明白，如果你用示波器测量只能看到输出方波，但如果加上一个rc低通滤波器就能看到马鞍波了。可能有人会有疑问为什么要输出方波来等效，而不是用dac输出再像三极管放大那样直接输出马鞍波？因为那样要让晶体管工作在线性区，功耗是非常吓人的，就如同开关电源和线性电源一样。
  ![图2](https://img-blog.csdnimg.cn/img_convert/c85038db1564b45959171b8879a61209.png)  
可以用三个电流的矢量去合成一个矢量，一般有两个确定了第三个也就确定了，
![图3](https://img-blog.csdnimg.cn/img_convert/2817d077ee575e7abd79676bb49636b3.gif)   
**妈呀这个图好好！**  
 我们可以输出等效的电压，而电压与电流之间差的也只是一个系数。所以我们的最终目的可以略微的改一改，改成：计算要输出任意大小和方向的矢量时，ABC三相的占空比大小。  
然后用直角坐标系，把三相换成了两项要成2/3  

SVPWM实际上对应于交流电机中的三相电压源逆变器功率器件的一种特殊开关顺序和脉宽大小的组合，这种开关触发顺序和组合将在定子线圈中产生三相互差120°电角度、失真较小的正弦波电流波形，这正是我们驱动三相电机转动所需要的的电流波形。但如果直接去跟踪三个正弦波需要用到更加复杂的高阶控制器，无法保证实时性，因此就要通过一些矩阵变换，来使的控制变量变得简单
 

(2)pmsm比较适合用foc驱动，反动势是正弦波

